"use strict";

var authData = "";
var API_URL = "http://www.omdbapi.com/?t=";
var API_URL2 = "&y=&plot=short&r=json";
var FIREBASE_URL = "https://moviedatabase.firebaseio.com/";
var GETmovie_database = FIREBASE_URL + "movies.json";
// var movie_database = FIREBASE_URL + "users/" + authData.uid + "/movies.json";
var fb = new Firebase(FIREBASE_URL);
var $searchButton = $(".search-button");
var $addMovie = $(".addMovie");
var searchData;
var initLoad = true;

///////search button & Calling Function///
$searchButton.click(function () {
  $(".Search-details").empty();
  var title = $(this).prev().val();
  var url = API_URL + title + API_URL2;
  $.get(url, function (search) {
    searchData = search;
    movieSearchReturn(searchData);
  }, "json");
});

//////////returned info from API call above//
function movieSearchReturn(searchData) {
  var docFragment = document.createDocumentFragment();
  var tbody = document.querySelector(".Search-details");
  var tr = document.createElement("TR");
  tr.setAttribute("class", "movie");
  tbody.appendChild(tr);

  var td = document.createElement("TD");
  td.setAttribute("class", "Poster");
  tr.appendChild(td);
  var img = document.createElement("img");
  img.setAttribute("class", "posterimg");
  var Poster = searchData.Poster;
  img.setAttribute("src", Poster);
  td.appendChild(img);

  var td_0 = document.createElement("TD");
  td_0.setAttribute("class", "Title");
  tr.appendChild(td_0);
  var text_0 = document.createTextNode(searchData.Title);
  td_0.appendChild(text_0);

  var td_1 = document.createElement("TD");
  td_1.setAttribute("class", "Year");
  tr.appendChild(td_1);
  var text_1 = document.createTextNode(searchData.Year);
  td_1.appendChild(text_1);

  var td_2 = document.createElement("TD");
  td_2.setAttribute("class", "Rating");
  tr.appendChild(td_2);
  var text_2 = document.createTextNode(searchData.imdbRating);
  td_2.appendChild(text_2);

  return docFragment; //search return from button function above//
}

/////////Begin Firebase////////
function movieFirebase() {
  authData = fb.getAuth();
  var movie_database = FIREBASE_URL + "users/" + authData.uid + "/movies.json";
  $.get(movie_database, function (movieDetails) {
    Object.keys(movieDetails).forEach(function (id) {
      addMovieDetail(movieDetails[id], id);
    });
  });
}

var $movieDetails = $(".Details");
$movieDetails.on("click", ".btn", function () {
  var $movie = $(this).closest(".movie");
  var id = $movie.attr("data-id");
  var movie_database = FIREBASE_URL + "users/" + authData.uid + "/movies.json";
  var deleteUrl = movie_database.slice(0, -5) + "/" + id + ".json";

  $.ajax({
    url: deleteUrl,
    type: "DELETE",
    success: function success() {
      $movie.remove();
    }
  });
});

////////Add Movie to DataBase/////
movieFirebase();
$addMovie.click(function () {
  var title = $(this).prev().val();
  authData = fb.getAuth();
  var movie_database = FIREBASE_URL + "users/" + authData.uid + "/movies.json";
  console.log(movie_database, "authData");
  $.post(movie_database, JSON.stringify(searchData), function (res) {
    addMovieDetail(searchData, res.Title);
  }, "json");
});

// JSONP_CALLBACK
function addMovieDetail(data, id) {
  var detail = popMovieDetails(data, id);
  var $target = $(".movie-list");
  // $target.empty();
  $target.append(detail);
}

//CREATES DOM ELEMENT
function popMovieDetails(data, id) {
  var docFragment = document.createDocumentFragment();
  //beginning of function how things are pulled into pg//
  var tbody = document.querySelector(".Details");
  var tr = document.createElement("TR");
  tr.setAttribute("class", "movie");
  tr.setAttribute("data-id", id);
  tbody.appendChild(tr);

  var td = document.createElement("TD");
  td.setAttribute("class", "Poster");
  tr.appendChild(td);
  var img = document.createElement("img");
  img.setAttribute("class", "posterimg");
  var Poster = data.Poster;
  img.setAttribute("src", Poster);
  td.appendChild(img);

  var td_0 = document.createElement("TD");
  td_0.setAttribute("class", "Title");
  tr.appendChild(td_0);
  var text_0 = document.createTextNode(data.Title);
  td_0.appendChild(text_0);

  var td_1 = document.createElement("TD");
  td_1.setAttribute("class", "Year");
  tr.appendChild(td_1);
  var text_1 = document.createTextNode(data.Year);
  td_1.appendChild(text_1);

  var td_2 = document.createElement("TD");
  td_2.setAttribute("class", "Rating");
  tr.appendChild(td_2);
  var text_2 = document.createTextNode(data.imdbRating);
  td_2.appendChild(text_2);

  var td_3 = document.createElement("TD");
  td_3.setAttribute("class", "Watched");
  tr.appendChild(td_3);

  var text_3 = document.createTextNode("Watched");
  var btn = document.createElement("button");
  btn.setAttribute("class", "btn btn-danger");
  btn.setAttribute("class", "btn btn-delete");
  var btn_text = document.createTextNode("Delete");
  btn.appendChild(btn_text);
  td_3.appendChild(btn);
  return docFragment;
  console.log(data.Poster);
}

/* /*/ //run function here//*/
function getJSON(url, cb) {
  var script = document.createElement("script");
  script.src = url + "&callback=" + cb;

  document.body.appendChild(script);
}
//# sourceMappingURL=data:application/json;base64,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QUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztBQUN0QyxJQUFFLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDOztBQUVyQixNQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ2hELE1BQUksR0FBRyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDM0MsS0FBRyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztBQUM1QyxLQUFHLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0FBQzVDLE1BQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0MsS0FBRyxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUM1QixNQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ3BCLFNBQU8sV0FBVyxDQUFDO0FBQ25CLFNBQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0NBQzFCOzs7QUFHRCxTQUFTLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFO0FBQ3hCLE1BQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDOUMsUUFBTSxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsWUFBWSxHQUFHLEVBQUUsQ0FBQzs7QUFFckMsVUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7Q0FDbkMiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBhdXRoRGF0YSA9ICcnO1xudmFyIEFQSV9VUkwgPSBcImh0dHA6Ly93d3cub21kYmFwaS5jb20vP3Q9XCI7XG52YXIgQVBJX1VSTDIgPSBcIiZ5PSZwbG90PXNob3J0JnI9anNvblwiO1xudmFyIEZJUkVCQVNFX1VSTCA9XCJodHRwczovL21vdmllZGF0YWJhc2UuZmlyZWJhc2Vpby5jb20vXCI7XG52YXIgR0VUbW92aWVfZGF0YWJhc2UgPSBGSVJFQkFTRV9VUkwgKyBcIm1vdmllcy5qc29uXCI7XG4vLyB2YXIgbW92aWVfZGF0YWJhc2UgPSBGSVJFQkFTRV9VUkwgKyBcInVzZXJzL1wiICsgYXV0aERhdGEudWlkICsgXCIvbW92aWVzLmpzb25cIjtcbnZhciBmYiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRV9VUkwpO1xudmFyICRzZWFyY2hCdXR0b24gPSAkKCcuc2VhcmNoLWJ1dHRvbicpO1xudmFyICRhZGRNb3ZpZSA9ICQoXCIuYWRkTW92aWVcIik7XG52YXIgc2VhcmNoRGF0YTtcbnZhciBpbml0TG9hZCA9IHRydWU7XG5cblxuLy8vLy8vL3NlYXJjaCBidXR0b24gJiBDYWxsaW5nIEZ1bmN0aW9uLy8vXG4gICRzZWFyY2hCdXR0b24uY2xpY2soZnVuY3Rpb24gKCkge1xuICAkKFwiLlNlYXJjaC1kZXRhaWxzXCIpLmVtcHR5KCk7XG4gdmFyIHRpdGxlID0gJCh0aGlzKS5wcmV2KCkudmFsKCk7XG4gIHZhciB1cmwgPSBBUElfVVJMICsgdGl0bGUgKyBBUElfVVJMMjtcbiAgJC5nZXQodXJsLCBmdW5jdGlvbiAoc2VhcmNoKSB7XG4gICAgc2VhcmNoRGF0YSA9IHNlYXJjaDtcbiAgICBtb3ZpZVNlYXJjaFJldHVybihzZWFyY2hEYXRhKVxuICB9LCAnanNvbicpO1xufSk7XG5cbiAvLy8vLy8vLy8vcmV0dXJuZWQgaW5mbyBmcm9tIEFQSSBjYWxsIGFib3ZlLy9cbmZ1bmN0aW9uIG1vdmllU2VhcmNoUmV0dXJuIChzZWFyY2hEYXRhKSB7XG52YXIgZG9jRnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG52YXIgdGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLlNlYXJjaC1kZXRhaWxzXCIpO1xudmFyIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVFInKTtcbnRyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibW92aWVcIik7XG50Ym9keS5hcHBlbmRDaGlsZCh0cik7XG5cbnZhciB0ZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1REJyk7XG50ZC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIlBvc3RlclwiKTtcbnRyLmFwcGVuZENoaWxkKHRkKTtcbnZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgaW1nLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwicG9zdGVyaW1nXCIpO1xudmFyIFBvc3RlciA9IHNlYXJjaERhdGEuUG9zdGVyO1xuaW1nLnNldEF0dHJpYnV0ZShcInNyY1wiLCBQb3N0ZXIpO1xudGQuYXBwZW5kQ2hpbGQoaW1nKTtcblxudmFyIHRkXzAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdURCcpO1xudGRfMC5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIlRpdGxlXCIpO1xudHIuYXBwZW5kQ2hpbGQodGRfMCk7XG52YXIgdGV4dF8wID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoc2VhcmNoRGF0YS5UaXRsZSk7XG50ZF8wLmFwcGVuZENoaWxkKHRleHRfMCk7XG5cbnZhciB0ZF8xID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVEQnKTtcbnRkXzEuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJZZWFyXCIpO1xudHIuYXBwZW5kQ2hpbGQodGRfMSk7XG52YXIgdGV4dF8xID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoc2VhcmNoRGF0YS5ZZWFyKTtcbnRkXzEuYXBwZW5kQ2hpbGQodGV4dF8xKTtcblxudmFyIHRkXzIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdURCcpO1xudGRfMi5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIlJhdGluZ1wiKTtcbnRyLmFwcGVuZENoaWxkKHRkXzIpO1xudmFyIHRleHRfMiA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHNlYXJjaERhdGEuaW1kYlJhdGluZyk7XG50ZF8yLmFwcGVuZENoaWxkKHRleHRfMik7XG5cblxuICByZXR1cm4gZG9jRnJhZ21lbnQ7IC8vc2VhcmNoIHJldHVybiBmcm9tIGJ1dHRvbiBmdW5jdGlvbiBhYm92ZS8vXG59XG5cbi8vLy8vLy8vL0JlZ2luIEZpcmViYXNlLy8vLy8vLy9cbmZ1bmN0aW9uIG1vdmllRmlyZWJhc2UgKCkge1xuICBhdXRoRGF0YSA9IGZiLmdldEF1dGgoKTtcbiAgdmFyIG1vdmllX2RhdGFiYXNlID0gRklSRUJBU0VfVVJMICsgXCJ1c2Vycy9cIiArIGF1dGhEYXRhLnVpZCArIFwiL21vdmllcy5qc29uXCI7XG4kLmdldChtb3ZpZV9kYXRhYmFzZSwgZnVuY3Rpb24gKG1vdmllRGV0YWlscykge1xuICBPYmplY3Qua2V5cyhtb3ZpZURldGFpbHMpLmZvckVhY2goZnVuY3Rpb24gKGlkKSB7XG4gICAgYWRkTW92aWVEZXRhaWwobW92aWVEZXRhaWxzW2lkXSwgaWQpO1xuICB9KTtcbn0pO1xufVxuXG52YXIgJG1vdmllRGV0YWlscyA9ICQoJy5EZXRhaWxzJyk7XG4gICRtb3ZpZURldGFpbHMub24oJ2NsaWNrJywgJy5idG4nLCBmdW5jdGlvbiAoKSB7XG4gIHZhciAkbW92aWUgPSAkKHRoaXMpLmNsb3Nlc3QoJy5tb3ZpZScpO1xuICB2YXIgaWQgPSAkbW92aWUuYXR0cignZGF0YS1pZCcpO1xuICB2YXIgbW92aWVfZGF0YWJhc2UgPSBGSVJFQkFTRV9VUkwgKyBcInVzZXJzL1wiICsgYXV0aERhdGEudWlkICsgXCIvbW92aWVzLmpzb25cIjtcbiAgdmFyIGRlbGV0ZVVybCA9IG1vdmllX2RhdGFiYXNlLnNsaWNlKDAsIC01KSArICcvJyArIGlkICsgJy5qc29uJztcblxuICQuYWpheCh7XG4gICAgdXJsOiBkZWxldGVVcmwsXG4gICAgdHlwZTogJ0RFTEVURScsXG4gICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAkbW92aWUucmVtb3ZlKCk7XG4gICAgfVxuICB9KVxuXG59KTtcblxuLy8vLy8vLy9BZGQgTW92aWUgdG8gRGF0YUJhc2UvLy8vL1xubW92aWVGaXJlYmFzZSgpO1xuJGFkZE1vdmllLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHRpdGxlID0gJCh0aGlzKS5wcmV2KCkudmFsKCk7XG4gIGF1dGhEYXRhID0gZmIuZ2V0QXV0aCgpO1xuICB2YXIgbW92aWVfZGF0YWJhc2UgPSBGSVJFQkFTRV9VUkwgKyBcInVzZXJzL1wiICsgYXV0aERhdGEudWlkICsgXCIvbW92aWVzLmpzb25cIjtcbiAgY29uc29sZS5sb2cobW92aWVfZGF0YWJhc2UsIFwiYXV0aERhdGFcIilcbiAgJC5wb3N0KG1vdmllX2RhdGFiYXNlLCBKU09OLnN0cmluZ2lmeShzZWFyY2hEYXRhKSxcbiAgICAgICAgICAgZnVuY3Rpb24gKHJlcykge1xuICAgIGFkZE1vdmllRGV0YWlsKHNlYXJjaERhdGEsIHJlcy5UaXRsZSk7XG4gIH0sICdqc29uJyk7XG59KTtcblxuLy8gSlNPTlBfQ0FMTEJBQ0tcbmZ1bmN0aW9uIGFkZE1vdmllRGV0YWlsKGRhdGEsIGlkKSB7XG4gIHZhciBkZXRhaWwgPSBwb3BNb3ZpZURldGFpbHMoZGF0YSwgaWQpO1xuICB2YXIgJHRhcmdldCA9ICQoJy5tb3ZpZS1saXN0Jyk7XG4gIC8vICR0YXJnZXQuZW1wdHkoKTtcbiAgJHRhcmdldC5hcHBlbmQoZGV0YWlsKTtcbn1cblxuLy9DUkVBVEVTIERPTSBFTEVNRU5UXG5mdW5jdGlvbiBwb3BNb3ZpZURldGFpbHMoZGF0YSwgaWQpIHtcbiAgdmFyIGRvY0ZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuLy9iZWdpbm5pbmcgb2YgZnVuY3Rpb24gaG93IHRoaW5ncyBhcmUgcHVsbGVkIGludG8gcGcvL1xudmFyIHRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5EZXRhaWxzXCIpO1xudmFyIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVFInKTtcbnRyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibW92aWVcIik7XG50ci5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIsIGlkKVxudGJvZHkuYXBwZW5kQ2hpbGQodHIpO1xuXG52YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdURCcpO1xudGQuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJQb3N0ZXJcIik7XG50ci5hcHBlbmRDaGlsZCh0ZCk7XG52YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGltZy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInBvc3RlcmltZ1wiKTtcbnZhciBQb3N0ZXIgPSBkYXRhLlBvc3RlcjtcbmltZy5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgUG9zdGVyKTtcbnRkLmFwcGVuZENoaWxkKGltZyk7XG5cbnZhciB0ZF8wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVEQnKTtcbnRkXzAuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJUaXRsZVwiKTtcbnRyLmFwcGVuZENoaWxkKHRkXzApO1xudmFyIHRleHRfMCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRhdGEuVGl0bGUpO1xudGRfMC5hcHBlbmRDaGlsZCh0ZXh0XzApO1xuXG52YXIgdGRfMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1REJyk7XG50ZF8xLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiWWVhclwiKTtcbnRyLmFwcGVuZENoaWxkKHRkXzEpO1xudmFyIHRleHRfMSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRhdGEuWWVhcik7XG50ZF8xLmFwcGVuZENoaWxkKHRleHRfMSk7XG5cbnZhciB0ZF8yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVEQnKTtcbnRkXzIuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJSYXRpbmdcIik7XG50ci5hcHBlbmRDaGlsZCh0ZF8yKTtcbnZhciB0ZXh0XzIgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhLmltZGJSYXRpbmcpO1xudGRfMi5hcHBlbmRDaGlsZCh0ZXh0XzIpO1xuXG52YXIgdGRfMyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1REJyk7XG50ZF8zLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiV2F0Y2hlZFwiKTtcbnRyLmFwcGVuZENoaWxkKHRkXzMpO1xuXG52YXIgdGV4dF8zID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJXYXRjaGVkXCIpO1xudmFyIGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuYnRuLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnYnRuIGJ0bi1kYW5nZXInKTtcbmJ0bi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2J0biBidG4tZGVsZXRlJyk7XG52YXIgYnRuX3RleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnRGVsZXRlJyk7XG4gIGJ0bi5hcHBlbmRDaGlsZChidG5fdGV4dCk7XG50ZF8zLmFwcGVuZENoaWxkKGJ0bik7XG4gIHJldHVybiBkb2NGcmFnbWVudDtcbiAgY29uc29sZS5sb2coZGF0YS5Qb3N0ZXIpO1xufVxuXG4vKiAvKi8vL3J1biBmdW5jdGlvbiBoZXJlLy8qL1xuZnVuY3Rpb24gZ2V0SlNPTih1cmwsIGNiKSB7XG4gIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgc2NyaXB0LnNyYyA9IHVybCArICcmY2FsbGJhY2s9JyArIGNiO1xuXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbn1cblxuXG5cbiJdfQ==