"use strict";

var authData = "";
var API_URL = "http://www.omdbapi.com/?t=";
var API_URL2 = "&y=&plot=short&r=json";
var FIREBASE_URL = "https://moviedatabase.firebaseio.com/";
var GETmovie_database = FIREBASE_URL + "movies.json";
//var movie_database = FIREBASE_URL + "users/" + authData.uid + "/movies.json";
var fb = new Firebase(FIREBASE_URL);
var $searchButton = $(".search-button");
var $addMovie = $(".addMovie");
var searchData;
var initLoad = true;

///////search button & Calling Function///
$searchButton.click(function () {
  $(".Search-details").empty();
  var title = $(this).prev().val();
  var url = API_URL + title + API_URL2;
  $.get(url, function (search) {
    searchData = search;
    movieSearchReturn(searchData);
  }, "json");
});

//////////returned info from API call above//
function movieSearchReturn(searchData) {
  var docFragment = document.createDocumentFragment();
  var tbody = document.querySelector(".Search-details");
  var tr = document.createElement("TR");
  tr.setAttribute("class", "movie");
  tbody.appendChild(tr);

  var td = document.createElement("TD");
  td.setAttribute("class", "Poster");
  tr.appendChild(td);
  var img = document.createElement("img");
  img.setAttribute("class", "posterimg");
  var Poster = searchData.Poster;
  img.setAttribute("src", Poster);
  td.appendChild(img);

  var td_0 = document.createElement("TD");
  td_0.setAttribute("class", "Title");
  tr.appendChild(td_0);
  var text_0 = document.createTextNode(searchData.Title);
  td_0.appendChild(text_0);

  var td_1 = document.createElement("TD");
  td_1.setAttribute("class", "Year");
  tr.appendChild(td_1);
  var text_1 = document.createTextNode(searchData.Year);
  td_1.appendChild(text_1);

  var td_2 = document.createElement("TD");
  td_2.setAttribute("class", "Rating");
  tr.appendChild(td_2);
  var text_2 = document.createTextNode(searchData.imdbRating);
  td_2.appendChild(text_2);

  return docFragment; //search return from button function above//
}

/////////Begin Firebase////////
function movieFirebase() {
  authData = fb.getAuth();
  var movie_database = FIREBASE_URL + "users/" + authData.uid + "/movies.json";
  $.get(movie_database, function (movieDetails) {
    Object.keys(movieDetails).forEach(function (id) {
      addMovieDetail(movieDetails[id], id);
    });
  });
}

var $movieDetails = $(".Details");
$movieDetails.on("click", ".btn", function () {
  var $movie = $(this).closest(".movie");
  var id = $movie.attr("data-id");
  var deleteUrl = movie_database.slice(0, -5) + "/" + id + ".json";

  $.ajax({
    url: deleteUrl,
    type: "DELETE",
    success: function success() {
      $movie.remove();
    }
  });
});

////////Add Movie to DataBase/////
movieFirebase();
$addMovie.click(function () {
  var title = $(this).prev().val();
  authData = fb.getAuth();
  var movie_database = FIREBASE_URL + "users/" + authData.uid + "/movies.json";
  console.log(movie_database, "authData");
  $.post(movie_database, JSON.stringify(searchData), function (res) {
    addMovieDetail(searchData, res.Title);
  }, "json");
});

// JSONP_CALLBACK
function addMovieDetail(data, id) {
  var detail = popMovieDetails(data, id);
  var $target = $(".movie-list");
  // $target.empty();
  $target.append(detail);
}

//CREATES DOM ELEMENT
function popMovieDetails(data, id) {
  var docFragment = document.createDocumentFragment();
  //beginning of function how things are pulled into pg//
  var tbody = document.querySelector(".Details");
  var tr = document.createElement("TR");
  tr.setAttribute("class", "movie");
  tr.setAttribute("data-id", id);
  tbody.appendChild(tr);

  var td = document.createElement("TD");
  td.setAttribute("class", "Poster");
  tr.appendChild(td);
  var img = document.createElement("img");
  img.setAttribute("class", "posterimg");
  var Poster = data.Poster;
  img.setAttribute("src", Poster);
  td.appendChild(img);

  var td_0 = document.createElement("TD");
  td_0.setAttribute("class", "Title");
  tr.appendChild(td_0);
  var text_0 = document.createTextNode(data.Title);
  td_0.appendChild(text_0);

  var td_1 = document.createElement("TD");
  td_1.setAttribute("class", "Year");
  tr.appendChild(td_1);
  var text_1 = document.createTextNode(data.Year);
  td_1.appendChild(text_1);

  var td_2 = document.createElement("TD");
  td_2.setAttribute("class", "Rating");
  tr.appendChild(td_2);
  var text_2 = document.createTextNode(data.imdbRating);
  td_2.appendChild(text_2);

  var td_3 = document.createElement("TD");
  td_3.setAttribute("class", "Watched");
  tr.appendChild(td_3);

  var text_3 = document.createTextNode("Watched");
  var btn = document.createElement("button");
  btn.setAttribute("class", "btn btn-danger");
  btn.setAttribute("class", "btn btn-delete");
  var btn_text = document.createTextNode("Delete");
  btn.appendChild(btn_text);
  td_3.appendChild(btn);
  return docFragment;
  console.log(data.Poster);
}

/* /*/ //run function here//*/
function getJSON(url, cb) {
  var script = document.createElement("script");
  script.src = url + "&callback=" + cb;

  document.body.appendChild(script);
}
//# sourceMappingURL=data:application/json;base64,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QUFJLENBQUMsQ0FBQzs7QUFFckIsTUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUNoRCxNQUFJLEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzNDLEtBQUcsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLGdCQUFnQixDQUFDLENBQUM7QUFDNUMsS0FBRyxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQztBQUM1QyxNQUFJLFFBQVEsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQy9DLEtBQUcsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDNUIsTUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNwQixTQUFPLFdBQVcsQ0FBQztBQUNuQixTQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztDQUMxQjs7O0FBR0QsU0FBUyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRTtBQUN4QixNQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQzlDLFFBQU0sQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHLFlBQVksR0FBRyxFQUFFLENBQUM7O0FBRXJDLFVBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0NBQ25DIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYXV0aERhdGEgPSAnJztcbnZhciBBUElfVVJMID0gXCJodHRwOi8vd3d3Lm9tZGJhcGkuY29tLz90PVwiO1xudmFyIEFQSV9VUkwyID0gXCImeT0mcGxvdD1zaG9ydCZyPWpzb25cIjtcbnZhciBGSVJFQkFTRV9VUkwgPVwiaHR0cHM6Ly9tb3ZpZWRhdGFiYXNlLmZpcmViYXNlaW8uY29tL1wiO1xudmFyIEdFVG1vdmllX2RhdGFiYXNlID0gRklSRUJBU0VfVVJMICsgXCJtb3ZpZXMuanNvblwiO1xuLy92YXIgbW92aWVfZGF0YWJhc2UgPSBGSVJFQkFTRV9VUkwgKyBcInVzZXJzL1wiICsgYXV0aERhdGEudWlkICsgXCIvbW92aWVzLmpzb25cIjtcbnZhciBmYiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRV9VUkwpO1xudmFyICRzZWFyY2hCdXR0b24gPSAkKCcuc2VhcmNoLWJ1dHRvbicpO1xudmFyICRhZGRNb3ZpZSA9ICQoXCIuYWRkTW92aWVcIik7XG52YXIgc2VhcmNoRGF0YTtcbnZhciBpbml0TG9hZCA9IHRydWU7XG5cbi8vLy8vLy9zZWFyY2ggYnV0dG9uICYgQ2FsbGluZyBGdW5jdGlvbi8vL1xuICAkc2VhcmNoQnV0dG9uLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgJChcIi5TZWFyY2gtZGV0YWlsc1wiKS5lbXB0eSgpO1xuIHZhciB0aXRsZSA9ICQodGhpcykucHJldigpLnZhbCgpO1xuICB2YXIgdXJsID0gQVBJX1VSTCArIHRpdGxlICsgQVBJX1VSTDI7XG4gICQuZ2V0KHVybCwgZnVuY3Rpb24gKHNlYXJjaCkge1xuICAgIHNlYXJjaERhdGEgPSBzZWFyY2g7XG4gICAgbW92aWVTZWFyY2hSZXR1cm4oc2VhcmNoRGF0YSlcbiAgfSwgJ2pzb24nKTtcbn0pO1xuXG4gLy8vLy8vLy8vL3JldHVybmVkIGluZm8gZnJvbSBBUEkgY2FsbCBhYm92ZS8vXG5mdW5jdGlvbiBtb3ZpZVNlYXJjaFJldHVybiAoc2VhcmNoRGF0YSkge1xudmFyIGRvY0ZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xudmFyIHRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5TZWFyY2gtZGV0YWlsc1wiKTtcbnZhciB0ciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1RSJyk7XG50ci5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm1vdmllXCIpO1xudGJvZHkuYXBwZW5kQ2hpbGQodHIpO1xuXG52YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdURCcpO1xudGQuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJQb3N0ZXJcIik7XG50ci5hcHBlbmRDaGlsZCh0ZCk7XG52YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGltZy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInBvc3RlcmltZ1wiKTtcbnZhciBQb3N0ZXIgPSBzZWFyY2hEYXRhLlBvc3RlcjtcbmltZy5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgUG9zdGVyKTtcbnRkLmFwcGVuZENoaWxkKGltZyk7XG5cbnZhciB0ZF8wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVEQnKTtcbnRkXzAuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJUaXRsZVwiKTtcbnRyLmFwcGVuZENoaWxkKHRkXzApO1xudmFyIHRleHRfMCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHNlYXJjaERhdGEuVGl0bGUpO1xudGRfMC5hcHBlbmRDaGlsZCh0ZXh0XzApO1xuXG52YXIgdGRfMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1REJyk7XG50ZF8xLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiWWVhclwiKTtcbnRyLmFwcGVuZENoaWxkKHRkXzEpO1xudmFyIHRleHRfMSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHNlYXJjaERhdGEuWWVhcik7XG50ZF8xLmFwcGVuZENoaWxkKHRleHRfMSk7XG5cbnZhciB0ZF8yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVEQnKTtcbnRkXzIuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJSYXRpbmdcIik7XG50ci5hcHBlbmRDaGlsZCh0ZF8yKTtcbnZhciB0ZXh0XzIgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzZWFyY2hEYXRhLmltZGJSYXRpbmcpO1xudGRfMi5hcHBlbmRDaGlsZCh0ZXh0XzIpO1xuXG5cbiAgcmV0dXJuIGRvY0ZyYWdtZW50OyAvL3NlYXJjaCByZXR1cm4gZnJvbSBidXR0b24gZnVuY3Rpb24gYWJvdmUvL1xufVxuXG4vLy8vLy8vLy9CZWdpbiBGaXJlYmFzZS8vLy8vLy8vXG5mdW5jdGlvbiBtb3ZpZUZpcmViYXNlICgpIHtcbiAgYXV0aERhdGEgPSBmYi5nZXRBdXRoKCk7XG4gIHZhciBtb3ZpZV9kYXRhYmFzZSA9IEZJUkVCQVNFX1VSTCArIFwidXNlcnMvXCIgKyBhdXRoRGF0YS51aWQgKyBcIi9tb3ZpZXMuanNvblwiO1xuJC5nZXQobW92aWVfZGF0YWJhc2UsIGZ1bmN0aW9uIChtb3ZpZURldGFpbHMpIHtcbiAgT2JqZWN0LmtleXMobW92aWVEZXRhaWxzKS5mb3JFYWNoKGZ1bmN0aW9uIChpZCkge1xuICAgIGFkZE1vdmllRGV0YWlsKG1vdmllRGV0YWlsc1tpZF0sIGlkKTtcbiAgfSk7XG59KTtcbn1cblxudmFyICRtb3ZpZURldGFpbHMgPSAkKCcuRGV0YWlscycpO1xuICAkbW92aWVEZXRhaWxzLm9uKCdjbGljaycsICcuYnRuJywgZnVuY3Rpb24gKCkge1xuICB2YXIgJG1vdmllID0gJCh0aGlzKS5jbG9zZXN0KCcubW92aWUnKTtcbiAgdmFyIGlkID0gJG1vdmllLmF0dHIoJ2RhdGEtaWQnKTtcbiAgdmFyIGRlbGV0ZVVybCA9IG1vdmllX2RhdGFiYXNlLnNsaWNlKDAsIC01KSArICcvJyArIGlkICsgJy5qc29uJztcblxuICQuYWpheCh7XG4gICAgdXJsOiBkZWxldGVVcmwsXG4gICAgdHlwZTogJ0RFTEVURScsXG4gICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAkbW92aWUucmVtb3ZlKCk7XG4gICAgfVxuICB9KVxuXG59KTtcblxuLy8vLy8vLy9BZGQgTW92aWUgdG8gRGF0YUJhc2UvLy8vL1xubW92aWVGaXJlYmFzZSgpO1xuJGFkZE1vdmllLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgdmFyIHRpdGxlID0gJCh0aGlzKS5wcmV2KCkudmFsKCk7XG4gIGF1dGhEYXRhID0gZmIuZ2V0QXV0aCgpO1xuICB2YXIgbW92aWVfZGF0YWJhc2UgPSBGSVJFQkFTRV9VUkwgKyBcInVzZXJzL1wiICsgYXV0aERhdGEudWlkICsgXCIvbW92aWVzLmpzb25cIjtcbiAgY29uc29sZS5sb2cobW92aWVfZGF0YWJhc2UsIFwiYXV0aERhdGFcIilcbiAgJC5wb3N0KG1vdmllX2RhdGFiYXNlLCBKU09OLnN0cmluZ2lmeShzZWFyY2hEYXRhKSxcbiAgICAgICAgICAgZnVuY3Rpb24gKHJlcykge1xuICAgIGFkZE1vdmllRGV0YWlsKHNlYXJjaERhdGEsIHJlcy5UaXRsZSk7XG4gIH0sICdqc29uJyk7XG59KTtcblxuLy8gSlNPTlBfQ0FMTEJBQ0tcbmZ1bmN0aW9uIGFkZE1vdmllRGV0YWlsKGRhdGEsIGlkKSB7XG4gIHZhciBkZXRhaWwgPSBwb3BNb3ZpZURldGFpbHMoZGF0YSwgaWQpO1xuICB2YXIgJHRhcmdldCA9ICQoJy5tb3ZpZS1saXN0Jyk7XG4gIC8vICR0YXJnZXQuZW1wdHkoKTtcbiAgJHRhcmdldC5hcHBlbmQoZGV0YWlsKTtcbn1cblxuLy9DUkVBVEVTIERPTSBFTEVNRU5UXG5mdW5jdGlvbiBwb3BNb3ZpZURldGFpbHMoZGF0YSwgaWQpIHtcbiAgdmFyIGRvY0ZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuLy9iZWdpbm5pbmcgb2YgZnVuY3Rpb24gaG93IHRoaW5ncyBhcmUgcHVsbGVkIGludG8gcGcvL1xudmFyIHRib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5EZXRhaWxzXCIpO1xudmFyIHRyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVFInKTtcbnRyLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwibW92aWVcIik7XG50ci5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIsIGlkKVxudGJvZHkuYXBwZW5kQ2hpbGQodHIpO1xuXG52YXIgdGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdURCcpO1xudGQuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJQb3N0ZXJcIik7XG50ci5hcHBlbmRDaGlsZCh0ZCk7XG52YXIgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGltZy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInBvc3RlcmltZ1wiKTtcbnZhciBQb3N0ZXIgPSBkYXRhLlBvc3RlcjtcbmltZy5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgUG9zdGVyKTtcbnRkLmFwcGVuZENoaWxkKGltZyk7XG5cbnZhciB0ZF8wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVEQnKTtcbnRkXzAuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJUaXRsZVwiKTtcbnRyLmFwcGVuZENoaWxkKHRkXzApO1xudmFyIHRleHRfMCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRhdGEuVGl0bGUpO1xudGRfMC5hcHBlbmRDaGlsZCh0ZXh0XzApO1xuXG52YXIgdGRfMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1REJyk7XG50ZF8xLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiWWVhclwiKTtcbnRyLmFwcGVuZENoaWxkKHRkXzEpO1xudmFyIHRleHRfMSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRhdGEuWWVhcik7XG50ZF8xLmFwcGVuZENoaWxkKHRleHRfMSk7XG5cbnZhciB0ZF8yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnVEQnKTtcbnRkXzIuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJSYXRpbmdcIik7XG50ci5hcHBlbmRDaGlsZCh0ZF8yKTtcbnZhciB0ZXh0XzIgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhLmltZGJSYXRpbmcpO1xudGRfMi5hcHBlbmRDaGlsZCh0ZXh0XzIpO1xuXG52YXIgdGRfMyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ1REJyk7XG50ZF8zLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwiV2F0Y2hlZFwiKTtcbnRyLmFwcGVuZENoaWxkKHRkXzMpO1xuXG52YXIgdGV4dF8zID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJXYXRjaGVkXCIpO1xudmFyIGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuYnRuLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnYnRuIGJ0bi1kYW5nZXInKTtcbmJ0bi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2J0biBidG4tZGVsZXRlJyk7XG52YXIgYnRuX3RleHQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnRGVsZXRlJyk7XG4gIGJ0bi5hcHBlbmRDaGlsZChidG5fdGV4dCk7XG50ZF8zLmFwcGVuZENoaWxkKGJ0bik7XG4gIHJldHVybiBkb2NGcmFnbWVudDtcbiAgY29uc29sZS5sb2coZGF0YS5Qb3N0ZXIpO1xufVxuXG4vKiAvKi8vL3J1biBmdW5jdGlvbiBoZXJlLy8qL1xuZnVuY3Rpb24gZ2V0SlNPTih1cmwsIGNiKSB7XG4gIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgc2NyaXB0LnNyYyA9IHVybCArICcmY2FsbGJhY2s9JyArIGNiO1xuXG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbn1cblxuXG5cbiJdfQ==